<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <title>Todo Page</title>
    <!-- Include Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com"></script>
    <!-- Include Vue JS -->
    <script src="https://cdn.jsdelivr.net/npm/vue@2.6.14/dist/vue.min.js"></script>
</head>

<body class="bg-purple-200 ">
    <div id="app" class="flex flex-col items-center justify-center ">
        <nav class="flex fixed top-0 items-center justify-between flex-wrap bg-purple-600 p-6 w-full">
            <div class="flex items-center flex-shrink-0 text-white mr-6 ">
                <span class="font-bold text-xl">Todo Page : {{ username }} ! </span>
            </div>
            <div class="flex items-center">
                <div class="text-white mr-4">

                </div>
                <button class="bg-red-500 hover:bg-red-600 text-white font-bold py-2 px-4 rounded focus:outline-none focus:shadow-outline"
                    @click="logout()">Logout</button>
            </div>
        </nav>
        <br>
        <br>
        <br>
        <br>
        <br>
        <!-- {{todos}} -->
        <!-- <h1 class="text-gray-700 font-bold text-4xl mb-8 mt-10">Welcome,
            <span v-text="username"></span>!
        </h1> -->
        <div class="flex justify-conten-end">

            <button v-if="!tampilkanArsip" class="bg-cyan-500 hover:bg-cyan-700 text-white font-bold py-1 px-2 rounded focus:outline-none focus:shadow-outline mr-2"
                type="button" @click="tampilkanArsip=!tampilkanArsip; status=2;">
                Tampilkan Arsip Task
            </button>

            <button v-if="tampilkanArsip" class="bg-cyan-500 hover:bg-cyan-700 text-white font-bold py-1 px-2 rounded focus:outline-none focus:shadow-outline mr-2"
                type="button" @click="tampilkanArsip=!tampilkanArsip; status=1;">
                Tampilkan Task
            </button>
        </div>


        <div class="flex container mx-5">
            <div :class="kiri">
                <div class="p-5">

                    <div class="ml-20">
                        <h2 class="text-gray-700 font-bold text-3xl mb-4">Todo List</h2>

                        <div class="list-disc list-inside mb-4" v-for="todo, index in sortedTasks">

                            <div class="text-gray-700 " @click="dipilih = index" @mouseleave="dipilih = 99999">
                                <input @change="tandaiSelesai(todo)" v-model="todo.col7" type="checkbox" class="form-check-input" />
                                <span :class="{ 'line-through font-bdivd text-xl mb-3 ml-5': todo.col7 }">
                                    {{todo.col3}}
                                </span>
                                <br>
                                <span class="ml-5" v-if="todo.col4"> (deadline: {{todo.col4}})</span>
                                <div v-if="dipilih == index">

                                    <div v-if="todo.col5 == 1">
                                        <button class="bg-red-500 hover:bg-red-700 text-white font-bold py-1 px-2 rounded focus:outline-none focus:shadow-outline mr-2"
                                            type="button" @click="hapusTask(todo)">
                                            Hapus
                                        </button>

                                        <button class="bg-cyan-500 hover:bg-cyan-700 text-white font-bold py-1 px-2 rounded focus:outline-none focus:shadow-outline mr-2"
                                            type="button" @click="selesaiTask(todo)">
                                            Selesai
                                        </button>
                                    </div>
                                </div>

                            </div>


                        </div>
                    </div>

                    <!-- <div class="container w-25">
                        <table class="table table-bordered border-1" style="border: grey 1px solid;">
                            <thead>
                                <tr>
                                    <th class="font-weight-bold text-center" scope="col" style="width: 5%">
                                        <input type="checkbox" />
                                    </th>
                                    <th class="font-weight-bold text-center" scope="col" style="width: 60%">
                                        Tugas
                                    </th>
                                    <th class="font-weight-bold text-center" style="cursor: pointer; width: 15%" scope="col">
                                        Deadline
                                    </th>
                                    <th class="font-weight-bold text-center" scope="col" style="width: 15%">
                                        Aksi
                                        <button>
                                            Arsipkan Semua
                                        </button>
                                    </th>
                                    <th class="font-weight-bold text-center" scope="col" style="width: 10%">
                                        #
                                    </th>
                                </tr>
                            </thead>
                            <tbody style="border: grey 1px solid;">
                                <tr v-for="todo in TaskAktif" style="border: grey 1px solid;">
                                    <td class="text-center">
                                        <input type="checkbox" class="form-check-input" />
                                    </td>
                                    <td>
                                        <span>
                                            <i class="bi-alarm text-primary"></i>
                                        </span>
                                        {{todo.col3}}
                                    </td>
                                    <td class="text-center">
                                        <span>
                                            {{todo.col4}}
                                        </span>
                                        <br />
                                        <span>
                                            selesai :
                                            <input type="text" />
                                        </span>
                                    </td>
                                    <td class="text-center">


                                        <button class="btn btn-sm btn-success">
                                            Edit
                                        </button>
                                        <button class="btn btn-sm btn-danger">
                                            Hapus
                                        </button>
                                        <button>
                                            Arsipkan
                                        </button>

                                    </td>
                                    <td style="text-size: 5px">

                                        <button class="btn btn-sm btn-outline-danger">
                                            ▲
                                        </button>
                                        <button class="btn btn-sm btn-outline-success">
                                            ▼
                                        </button>

                                    </td>
                                </tr>
                            </tbody>
                        </table>
                    </div> -->


                </div>

            </div>
            <div v-if="showSidebar" class="flex justify-conten-center w-full ">
                <div class="mt-8 w-full">
                    <transition name="fade">
                        <div class="p-4 bg-white rounded-lg shadow-lg w-full ">
                            <h3 class="text-lg font-bold mb-4">Add Todo</h3>
                            <form class="flex flex-col w-full" @submit.prevent="addTodo">
                                <div class="mb-4">
                                    <label class="block text-gray-700 font-bold mb-2" for="task">
                                        Task
                                    </label>
                                    <input v-model="newTodo.task" class="appearance-none border rounded w-full py-2 px-3 text-gray-700 leading-tight focus:outline-none focus:shadow-outline"
                                        id="task" type="text" placeholder="Enter task">
                                </div>
                                <div class="mb-4">
                                    <label class="block text-gray-700 font-bold mb-2" for="deadline">
                                        Deadline
                                    </label>
                                    <input v-model="newTodo.deadline" class="appearance-none border rounded w-full py-2 px-3 text-gray-700 leading-tight focus:outline-none focus:shadow-outline"
                                        id="deadline" type="date">
                                </div>
                                <div class="mb-4 flex items-center">
                                    <input v-model="newTodo.monthly" class="mr-2 leading-tight" type="checkbox" id="monthly">
                                    <label class="text-gray-700 font-bold" for="monthly">
                                        Monthly
                                    </label>
                                </div>
                                <div class="flex justify-end">
                                    <button class="bg-blue-500 hover:bg-blue-700 text-white font-bold py-2 px-4 rounded focus:outline-none focus:shadow-outline mr-2"
                                        type="button" @click="saveTodo">
                                        Save
                                    </button>
                                    <button class="bg-red-500 hover:bg-red-700 text-white font-bold py-2 px-4 rounded focus:outline-none focus:shadow-outline"
                                        type="button" @click="closeAddTodoForm">
                                        Cancel
                                    </button>
                                </div>
                        </div>
                </div>
            </div>
        </div>


        <!-- tombol tambah task start-->

        <div class="fixed bottom-8 right-8" v-if="!showSidebar">
            <button class="bg-purple-600 hover:bg-purple-700 text-white font-bold py-2 px-4 rounded-full focus:outline-none focus:shadow-outline"
                @click="showAddTodoForm">
                <svg xmlns="http://www.w3.org/2000/svg" class="h-6 w-6" viewBox="0 0 20 20" fill="currentColor">
                    <path d="M4 6h12a1 1 0 0 1 0 2H4a1 1 0 0 1 0-2zm0 5h8a1 1 0 0 1 0 2H4a1 1 0 0 1 0-2z" />
                </svg>
            </button>
        </div>
        <!-- tombol tambah task end-->


    </div>

    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.0.2/dist/js/bootstrap.bundle.min.js" integrity="sha384-MrcW6ZMFYlzcLA8Nl+NtUVF0sA7MsXsP1UyJoMp4YLEuNSfAP+JcXn/tWtIaxVXM"
        crossorigin="anonymous"></script>
    <!-- ajax -->
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.5.1/jquery.min.js"></script>


    <script>
        new Vue({
            el: '#app',
            data() {
                return {
                    username: localStorage.getItem('username'),
                    password: localStorage.getItem('password'),
                    todos: [],
                    showForm: false,
                    newTodo: {
                        task: '',
                        deadline: '',
                        monthly: false
                    },
                    // showAddTodoForm: false,
                    showSidebar: false,
                    kiri: 'w-full ',
                    kanan: 'w-1/2 bg-red-300',
                    tampilkanArsip: false,
                    status: 1,
                    dipilih: '99999',

                }
            }
            ,
            computed: {

                TaskAktif: function () {
                    return this.todos.filter((blog) => {
                        return blog.col5 == this.status && blog.col2 == this.username;
                    });

                },
                sortedTasks() {
                    return this.TaskAktif.sort((a, b) => {
                        return new Date(a.col4) - new Date(b.col4);
                    });
                },
            },
            methods: {
                tandaiSelesai(x) {
                    // alert('update')
                    // var waktu1 = Date.now();
                    if (x.col7 == true) {
                        var itimestamp = x.id;
                        console.log(itimestamp);
                        var url = `https://script.google.com/macros/s/AKfycbzfOmAEsUqWORVFgVgp3-juYufE-2xrp5hn85E2hZT0hXLw8_Ur-9sxY1eCDQLo8mJI/exec?action=update&table=todo2023&id=${itimestamp}&data={"col7":true}`
                        // this.test = url;
                        // timestamp=${itimestamp}
                        let app = this;
                        $.ajax({
                            type: 'GET',
                            url: url,
                            crossDomain: true,
                            dataType: 'jsonp',
                            dataType: "text",
                            success: function (resultData) {
                                // alert('Task dipindahkan ke Arsip')
                                // app.GetDataTasks();
                                console.log('berhasil selesai')

                            }
                        });

                    } else {
                        var itimestamp = x.id;
                        console.log(itimestamp);
                        var url = `https://script.google.com/macros/s/AKfycbzfOmAEsUqWORVFgVgp3-juYufE-2xrp5hn85E2hZT0hXLw8_Ur-9sxY1eCDQLo8mJI/exec?action=update&table=todo2023&id=${itimestamp}&data={"col7":false}`
                        // this.test = url;
                        // timestamp=${itimestamp}
                        let app = this;
                        $.ajax({
                            type: 'GET',
                            url: url,
                            crossDomain: true,
                            dataType: 'jsonp',
                            dataType: "text",
                            success: function (resultData) {
                                // alert('Task dipindahkan ke Arsip')
                                // app.GetDataTasks();
                                console.log('berhasil selesai')

                            }
                        });

                    }
                },
                showAddTodoForm() {
                    this.showSidebar = true
                    this.kiri = "w-1/2"
                    this.kanan = "w-1/2"
                    // alert('oke')
                },
                closeAddTodoForm() {
                    this.showSidebar = false
                    this.kiri = "w-full"
                    // this.kanan = "w-1/3"
                    // alert('oke')
                },
                logout() {
                    localStorage.removeItem('username');
                    localStorage.removeItem('password');
                    window.location.href = 'login.html';
                },
                saveTodo() {

                    if (this.newTodo.task) {

                        var waktu1 = Date.now();
                        var a1 = encodeURIComponent(this.newTodo.task.toString());
                        var a2 = this.newTodo.deadline.toString();
                        var a3 = this.newTodo.monthly.toString();
                        var a4 = this.username.toString();
                        var a5 = 1;
                        var lin = `https://script.google.com/macros/s/AKfycbzfOmAEsUqWORVFgVgp3-juYufE-2xrp5hn85E2hZT0hXLw8_Ur-9sxY1eCDQLo8mJI/exec?action=insert&table=todo2023&data={"id":${waktu1}, "col2":"'${a4}","col3":"'${a1}","col4":"'${a2}","col5":"${a5} ","col6":"${a3}","col7":"false"}`;
                        // this.test = lin;
                        let app = this;
                        $.ajax({
                            type: 'GET',
                            url: lin,
                            crossDomain: true,
                            dataType: 'jsonp',
                            dataType: "text",
                            success: function (resultData) {
                                //   alert("Save Complete");
                                app.newTodo.task = ''
                                app.newTodo.deadline = ''
                                app.newTodo.monthly = false

                                // app.GetDataTasks();
                            }
                        });

                        alert('Task Berhasil di Simpan')
                        app.GetDataTasks();
                    }
                    else {
                        alert('Masih terdapat data yang belum di input')
                    }
                },
                GetDataTasks() {
                    this.todos = [];
                    this.queryUser();
                    // var url ="https://script.google.com/macros/s/AKfycbyc7wzSrUGxQhcBN5EfVC-rNRj3wncZJOVTWAChXtSwnrHkGjoaoI91bggme_fUOIP9/exec?action=read&table=query";
                    var url = "https://script.google.com/macros/s/AKfycbzfOmAEsUqWORVFgVgp3-juYufE-2xrp5hn85E2hZT0hXLw8_Ur-9sxY1eCDQLo8mJI/exec?action=read&table=todo2023";

                    let app = this;
                    $.getJSON(url, function (json) {
                        // console.log(json.data);
                        app.todos = json.data;
                    });
                },
                hapusTask(aa) {
                    // this.todos = [];
                    // alert('update')
                    // var waktu1 = Date.now();
                    var itimestamp = aa.id;
                    console.log(itimestamp);
                    var url = `https://script.google.com/macros/s/AKfycbzfOmAEsUqWORVFgVgp3-juYufE-2xrp5hn85E2hZT0hXLw8_Ur-9sxY1eCDQLo8mJI/exec?action=update&table=todo2023&id=${itimestamp}&data={"col5":0}`
                    // this.test = url;
                    // timestamp=${itimestamp}
                    let app = this;
                    $.ajax({
                        type: 'GET',
                        url: url,
                        crossDomain: true,
                        dataType: 'jsonp',
                        dataType: "text",
                        success: function (resultData) {
                            alert('Task Dihapus')
                            app.GetDataTasks();

                        }
                    });

                },
                selesaiTask(aa) {

                    // alert('update')
                    // var waktu1 = Date.now();
                    var itimestamp = aa.id;
                    console.log(itimestamp);
                    var url = `https://script.google.com/macros/s/AKfycbzfOmAEsUqWORVFgVgp3-juYufE-2xrp5hn85E2hZT0hXLw8_Ur-9sxY1eCDQLo8mJI/exec?action=update&table=todo2023&id=${itimestamp}&data={"col5":2}`
                    // this.test = url;
                    // timestamp=${itimestamp}
                    let app = this;
                    $.ajax({
                        type: 'GET',
                        url: url,
                        crossDomain: true,
                        dataType: 'jsonp',
                        dataType: "text",
                        success: function (resultData) {
                            alert('Task dipindahkan ke Arsip')
                            app.GetDataTasks();

                        }
                    });

                },
                queryUser() {
                    // alert('update')
                    // var waktu1 = Date.now();
                    var a1 = this.username.toString();
                    // console.log(itimestamp);
                    var url = `https://script.google.com/macros/s/AKfycbzfOmAEsUqWORVFgVgp3-juYufE-2xrp5hn85E2hZT0hXLw8_Ur-9sxY1eCDQLo8mJI/exec?action=update&table=pengguna&id=1&data={"col2":"${a1}"}`
                    // this.test = url;
                    // timestamp=${itimestamp}
                    let app = this;
                    $.ajax({
                        type: 'GET',
                        url: url,
                        crossDomain: true,
                        dataType: 'jsonp',
                        dataType: "text",
                        success: function (resultData) {
                            console.log('berhasil ganti user')
                            // alert('Task dipindahkan ke Arsip')
                            // app.GetDataTasks();

                        }
                    });

                },

            },
            created() {
                if (!localStorage.getItem("username") || !localStorage.getItem("password")) {
                    window.location.href = "/todo/login.html";
                }
                this.queryUser();
                this.GetDataTasks();
            },

        });
    </script>
</body>

</html>
