<!doctype html>
<html lang="en">

<head>
    <!-- Required meta tags -->
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">

    <!-- Bootstrap CSS -->
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.0.2/dist/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-EVSTQN3/azprG1Anm3QDgpJLIm9Nao0Yz1ztcQTwFspd3yD65VohhpuuCOmLASjC"
        crossorigin="anonymous">

    <title>Hello, world!</title>
</head>

<body>
    <div class="container" div id="app">
        <template>
            <table class="table">
                <thead>
                    <tr>
                        <th>Key</th>
                        <th>Value</th>
                    </tr>
                </thead>
                <tbody>
                    <tr v-for="key in Object.keys(localStorage)" :key="key">
                        <td>{{ key }}</td>
                        <td>{{ localStorage[key] }}</td>
                    </tr>
                </tbody>
            </table>
        </template>


        <template v-if="!isLoggedIn">
            <div>
                <ul class="nav nav-tabs">
                    <li class="nav-item">
                        <a class="nav-link active" @click="formLogin = true" data-toggle="tab" href="#login">Login</a>
                    </li>
                    <li class="nav-item">
                        <a class="nav-link" @click="formLogin = false" data-toggle="tab" href="#register">Register</a>
                    </li>
                </ul>
                <div class="tab-content">
                    <div class="tab-pane active" id="login">
                        <!-- Form login -->
                        <div>


                            <form v-if="formLogin" @submit.prevent="login" class="form-login">
                                <h1>Form Login</h1>
                                <div class="form-group">
                                    <label for="nama">email</label>
                                    <input v-model="form1.email" type="text" id="email1" class="form-control" placeholder="Masukkan email" required />
                                </div>
                                <div class="form-group">
                                    <label for="password">Password</label>
                                    <input v-model="form1.password" type="password" id="password" class="form-control" placeholder="Masukkan password" required
                                    />
                                </div>
                                <button type="submit" class="mt-3 btn btn-primary">Masuk</button>
                            </form>



                        </div>

                        <!-- Form register -->
                        <div v-if="!isLoggedIn & !formLogin">
                            <h1>Form Register</h1>
                            <template>
                                <form @submit.prevent="submitRegister">
                                    <div class="form-group">
                                        <label for="nama">Nama</label>
                                        <input type="text" class="form-control" id="nama" v-model="form.nama" required>
                                    </div>
                                    <div class="form-group">
                                        <label for="email">Email</label>
                                        <input type="email" class="form-control" id="email" v-model="form.email" required>
                                    </div>
                                    <div class="form-group">
                                        <label for="password">Password</label>
                                        <input type="password" class="form-control" id="password" v-model="form.password" required>
                                    </div>
                                    <div class="form-group">
                                        <label for="verifikasi_password">Verifikasi Password</label>
                                        <input type="password" class="form-control" id="verifikasi_password" v-model="form.verifikasi_password" required>
                                    </div>
                                    <div class="form-group">
                                        <label for="nama">Kode Satker</label>
                                        <input type="text" class="form-control" id="kodeSatker" v-model="form.kodeSatker" required>
                                    </div>
                                    <div class="form-group">
                                        <label for="level">Level</label>
                                        <select class="form-control" id="level" v-model="form.level" required>
                                            <option v-for="option in options" v-bind:value="option.value">
                                                {{ option.text }}
                                            </option>
                                        </select>
                                    </div>
                                    <button type="submit" class="mt-3 btn btn-primary">Daftar</button>
                                </form>
                            </template>
                        </div>
                    </div>
                </div>
            </div>
        </template>
        <form v-else @submit.prevent="logout" class="logout-form">
            Anda sudah masuk sebagai {{ form1.email }}
            <button type="submit">Keluar</button>
        </form>






    </div>


    <script src="https://cdn.jsdelivr.net/npm/vue/dist/vue.js"></script>
    <script>
        var app = new Vue({
            el: '#app',
            data() {
                return {
                    form: {
                        nama: '',
                        email: '',
                        password: '',
                        verifikasi_password: '',
                        level: '',
                        kodeSatker: '',
                    },
                    options: [
                        { text: 'Pilih Level', value: '' },
                        { text: 'Admin', value: 'admin' },
                        { text: 'User', value: 'user' },
                    ],
                    form1: {
                        nama: '',
                        email: ''
                    },
                    isLoggedIn: false,
                    formLogin: true,
                }
            },
            methods: {
                async submitRegister() {
                    // Validasi form
                    if (!this.form.nama || !this.form.email || !this.form.password || !this.form.verifikasi_password || !this.form.level) {
                        alert('Semua field harus diisi!')
                        return
                    }

                    if (this.form.password !== this.form.verifikasi_password) {
                        alert('Password dan verifikasi password harus sama!')
                        return
                    }

                    // Ambil data dari Local Storage
                    let data = localStorage.getItem('form-register')
                    if (data) {
                        data = JSON.parse(data)
                    } else {
                        data = []
                    }

                    // Cek apakah data sudah ada di dalam array
                    // if (data.includes(this.form)) {
                    //     alert('Data sudah ada di dalam array!')
                    //     return
                    // }
                    if (data.length > 0) {
                        data.forEach((item) => {
                            if (item.email === this.form.email) {
                                alert('Email sudah terdaftar!')
                                this.form.email = ""
                                return

                            }
                        })
                    }





                    // Tambahkan form ke dalam array
                    data.push(this.form)

                    // Simpan array ke dalam Local Storage
                    localStorage.setItem('form-register', JSON.stringify(data))
                    console.log('Form register berhasil disimpan!')



                },
                login() {
                    // Validasi form
                    if (!this.form1.email || !this.form1.password) {
                        alert('Email dan password harus diisi!')
                        return
                    }

                    let data = localStorage.getItem('form-register')
                    if (data) {
                        data = JSON.parse(data)
                    } else {
                        data = []
                    }

                    // Cek apakah email dan password cocok dengan data di array
                    const user = data.find((item) => item.email === this.form1.email && item.password === this.form1.password)
                    if (!user) {
                        alert('Email atau password salah!')
                        return
                    }

                    localStorage.setItem('form', JSON.stringify(this.form1))
                    this.isLoggedIn = true
                    console.log('Anda sudah masuk sebagai ' + this.form1.email)
                },
                logout() {
                    // Hapus data dari Local Storage

                    localStorage.removeItem('form')
                    localStorage.removeItem('AdminLTE:Demo:MessageShowed')
                    localStorage.removeItem('AdminLTE:IFrame:Options')

                    this.isLoggedIn = false
                    console.log('Anda sudah keluar!')

                },





            },

            computed: {
                localStorage() {
                    return window.localStorage
                },
            },
            mounted() {
                // Cek apakah sudah login
                const form = localStorage.getItem('form')
                if (form) {
                    this.form1 = JSON.parse(form)
                    this.isLoggedIn = true
                }


            },


        })
    </script>

    <!-- Optional JavaScript; choose one of the two! -->

    <!-- Option 1: Bootstrap Bundle with Popper -->
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.0.2/dist/js/bootstrap.bundle.min.js" integrity="sha384-MrcW6ZMFYlzcLA8Nl+NtUVF0sA7MsXsP1UyJoMp4YLEuNSfAP+JcXn/tWtIaxVXM"
        crossorigin="anonymous"></script>

    <!-- Option 2: Separate Popper and Bootstrap JS -->
    <!--
    <script src="https://cdn.jsdelivr.net/npm/@popperjs/core@2.9.2/dist/umd/popper.min.js" integrity="sha384-IQsoLXl5PILFhosVNubq5LC7Qb9DXgDA9i+tQ8Zj3iwWAwPtgFTxbJ8NT4GN1R8p" crossorigin="anonymous"></script>
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.0.2/dist/js/bootstrap.min.js" integrity="sha384-cVKIPhGWiC2Al4u+LWgxfKTRIcfu0JTxR+EQDz/bgldoEyl4H0zUF0QKbrJ0EcQF" crossorigin="anonymous"></script>
    -->
</body>

</html>
